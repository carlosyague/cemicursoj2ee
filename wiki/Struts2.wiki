#summary Guía introductoria a Struts 2
#sidebar TableOfContents

[http://struts.apache.org/2.1.8/index.html http://struts.apache.org/2.1.8/images/struts2.png]

= Introducción =

Sitio: http://struts.apache.org/2.1.8/index.html

Documentación oficial: http://struts.apache.org/2.1.8/docs/core-developers-guide.html

Tutoriales recomendados: http://struts.apache.org/2.1.8/docs/tutorials.html

[http://www.opensymphony.com/webwork/ http://struts.apache.org/2.1.8/images/struts2-merger2.png]

Extraído de `struts-2.1.8\src\core\pom.xml`
{{{
<dependency>
  <groupId>com.opensymphony</groupId>
  <artifactId>xwork-core</artifactId>
  <version>2.1.6</version>
</dependency>
}}}

_Obtengo los fuentes tanto de [http://release.opensymphony.com/xwork/2.1.5/xwork-2.1.5-src.zip OpenSymphony xwork-core 2.1.5], como de [http://struts.apache.org/download.cgi#struts218 Apache Struts 2.1.8] para incluirlos en el debugger de Eclipse_

Tutorial: http://www.vaannila.com/struts-2/struts-2-tutorial/struts-2-tutorial.html

[http://www.vaannila.com/struts-2/struts-2-tutorial/struts-2-tutorial.html http://www.vaannila.com/images/struts2/Interceptor1Pic1.gif]

= Ejemplos introductorios =

 # Struts 2 Annotation Tutorial 1 [http://cemicursoj2ee.googlecode.com/svn/trunk/Struts2Example1/ Struts2Example1]
 # Struts 2 Annotation Tutorial 2 [http://cemicursoj2ee.googlecode.com/svn/trunk/Struts2Example2/ Struts2ExampleAnnotations]
   * http://struts.apache.org/2.0.11.1/docs/annotations.html
 # Struts 2 Hello World Tutorial [http://cemicursoj2ee.googlecode.com/svn/trunk/Struts2HelloWorld1/ Struts2HelloWorld1]
 # Struts 2 UI Tags Tutorial [http://cemicursoj2ee.googlecode.com/svn/trunk/Struts2Example7/ Struts2ExampleUITags]
   * http://struts.apache.org/2.0.11.1/docs/ui-tags.html
 # Struts 2 Data Tags Tutorial [http://cemicursoj2ee.googlecode.com/svn/trunk/Struts2Example11/ Struts2ExampleDataTags]
 # Struts 2 Bean Tag Tutorial [http://cemicursoj2ee.googlecode.com/svn/trunk/Struts2Example12/ Struts2ExampleBeanTag]
 # Struts 2 Control Tags Tutorial [http://cemicursoj2ee.googlecode.com/svn/trunk/Struts2Example10/ Struts2ExampleControlTags]
 # Struts 2 OGNL Expression Language Tutorial [http://cemicursoj2ee.googlecode.com/svn/trunk/Struts2ExampleOGNL/ Struts2ExampleOGNL]
   * _OGNL:_ http://www.opensymphony.com/ognl/
 # Struts 2 Interceptors Tutorial [http://cemicursoj2ee.googlecode.com/svn/trunk/Struts2ExampleInterceptor1/ Struts2ExampleInterceptor1]
 # Struts 2 Interceptors Tutorial [http://cemicursoj2ee.googlecode.com/svn/trunk/Struts2ExampleInterceptor2/ Struts2ExampleInterceptor2]
   * _XWork Default Interceptors:_ http://www.opensymphony.com/xwork/wikidocs/XWork%20Interceptors.html
   * http://struts.apache.org/2.1.8/docs/interceptors.html
 # DispatchAction Functionality in Struts 2 Tutorial [http://cemicursoj2ee.googlecode.com/svn/trunk/Struts2ExampleDispatchAction1/ Struts2ExampleDispatchAction1]
 # Dynamic Method Invocation Tutorial [http://cemicursoj2ee.googlecode.com/svn/trunk/Struts2ExampleDynamicMethodInvocation/ Struts2ExampleDynamicMethodInvocation]
 # Struts 2 Validation Tutorial [http://cemicursoj2ee.googlecode.com/svn/trunk/Struts2ExampleValidation1/ Struts2ExampleValidation1]
 # Struts 2 Validation Using XML File Tutorial [http://cemicursoj2ee.googlecode.com/svn/trunk/Struts2ExampleValidation2/ Struts2ExampleValidation2]
   * _XWork Validation Framework:_ http://www.opensymphony.com/xwork/wikidocs/Validation%20Framework.html 
   * http://struts.apache.org/2.1.8/docs/validation.html
 # Domain Object as JavaBeans Property Tutorial [http://cemicursoj2ee.googlecode.com/svn/trunk/Struts2ExampleDomainObject/ Struts2ExampleDomainObject]
 # Struts 2 ModelDriven Action Tutorial [http://cemicursoj2ee.googlecode.com/svn/trunk/Struts2ExampleModelDriven/ Struts2ExampleModelDriven]
   * http://struts.apache.org/2.1.8/docs/model-driven.html
 # Struts 2 File Upload Tutorial [http://cemicursoj2ee.googlecode.com/svn/trunk/Struts2ExampleFileUpload/ Struts2ExampleFileUpload]
 # Struts 2 Tiles Integration Tutorial [http://cemicursoj2ee.googlecode.com/svn/trunk/Struts2ExampleTiles/ Struts2ExampleTiles]
 # Struts 2 CRUD Tutorial [http://cemicursoj2ee.googlecode.com/svn/trunk/Struts2ExampleX/ Struts2ExampleX]
 

= Ejemplo de aplicación Struts 2 básica =

_NOTA: Para poder probar este ejemplo deberemos instalarnos ApacheMaven2 y MySQL 5.0_

== Creamos la estructura a partir de un archetipo Maven ==

Creamos una aplicación *struts2app* a partir del archetipo Maven *Struts 2 Basic*:

Nos abrimos una consola de comandos y nos situamos en el directorio de nuestro workspace de Eclipse `C:\CEMi_J2EE`:

{{{
C:\CEMi_J2EE> mvn archetype:create -DarchetypeGroupId=org.appfuse.archetypes -DarchetypeArtifactId=appfuse-basic-struts -DremoteRepositories=http://static.appfuse.org/releases -DarchetypeVersion=2.0.2 -DgroupId=es.cemi.samples -DartifactId=struts2app
}}}

== Compilamos el proyecto Maven == 

A continuación realizamos la primera compilación del ejemplo. Dicha compilación con Maven tiene asociada una descarga importante de JARs que puede tardar mucho tiempo. Para acelerar este proceso, contamos en el aptdo. de descargas con un *repository.rar* que podremos descomprimir en nuestro repositorio Maven: `%M2_HOME%\repository`

Una vez tengamos todos los JARs, ya podemos proceder a realizar la primera compilación:

{{{
C:\CEMi_J2EE\struts2app> mvn clean install
}}}

{{{
...
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESSFUL
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 8 minutes 1 second
[INFO] Finished at: Thu Oct 22 21:32:14 CEST 2009
[INFO] Final Memory: 65M/254M
[INFO] ------------------------------------------------------------------------
C:\CEMi_J2EE\struts2app>
}}}

== Desplegamos la aplicación en un Servidor ==

Arrancamos la aplicación mediante el [http://mojo.codehaus.org/tomcat-maven-plugin/ Tomcat Maven Plugin]:

{{{
C:\CEMi_J2EE\struts2app> mvn tomcat:run-war
}}} 

{{{
[INFO] [war:war {execution: default-war}]
...
[INFO] Generating war C:\00-FACTORIA\Proyectos\CEMi_J2EE\struts2app\target\struts2app-1.0-SNAPSHOT.war
[INFO] Building war: C:\00-FACTORIA\Proyectos\CEMi_J2EE\struts2app\target\struts2app-1.0-SNAPSHOT.war
[INFO] [tomcat:run-war {execution: default-cli}]
[INFO] Running war on http://localhost:8080/struts2app
...
INFO: Initializing Spring root WebApplicationContext
[struts2app] WARN [main] Settings.getLocale(143) | Settings: Could not parse struts.locale setting, substituting default VM locale
23-oct-2009 16:01:07 org.apache.coyote.http11.Http11Protocol init
INFO: Initializing Coyote HTTP/1.1 on http-8080
23-oct-2009 16:01:07 org.apache.coyote.http11.Http11Protocol start
INFO: Starting Coyote HTTP/1.1 on http-8080
}}}

== Ejecutamos la aplicación ==

Accedemos a la aplicación desde un navegador: http://localhost:8080/struts2app

Introducimos las credenciales: `admin`/`admin`

== Importamos a Eclipse el proyecto Maven ==

Por último, importamos *struts2app* a nuestro _workspace_ de Eclipse. Para realizar esta operación, tenemos dos posibilidades:
 # Utilizamos el plugin de Eclipse para Maven: [http://www.eclipse.org/iam/ Eclipse IAM]
 # Utilizamos el plugin de Maven [http://maven.apache.org/plugins/maven-eclipse-plugin/ Maven Eclipse Plugin], tal y como se explica en [ApacheMaven2#Convertir_un_proyecto_Maven_a_Eclipse Convertir un proyecto Maven a Eclipse]

== Creamos una nueva Entidad ==

Creamos una Entidad `Person` con anotaciones JPA:

`es.cemi.samples.model.Person`
{{{
import org.appfuse.model.BaseObject;

import javax.persistence.Entity;
import javax.persistence.GenerationType;
import javax.persistence.Id;
import javax.persistence.GeneratedValue;
import javax.persistence.Column;

@Entity
public class Person extends BaseObject {
  private Long id;
  private String firstName;
  private String lastName;
  
  // Eclipse > Source > Generate getter & setters
  ..
  @Id @GeneratedValue(strategy = GenerationType.AUTO) 
  public Long getId() {
  ..
  @Column(name="first_name", length=50)
  public String getFirstName() {
  ..
  @Column(name="last_name", length=50)
  public String getLastName() {
  ..
}
}}}

Invocamos al plugin de AppFuse para la generación de todo el esqueleto de código asociado a dicha entidad:

{{{
C:\CEMi_J2EE\struts2app>mvn appfuse:gen -Dentity=Person
}}}

Esta acción genera los siguientes archivos:
 * src/main/java/es/cemi/samples/webapp/action/PersonAction.java
 * src/main/resources/es/cemi/samples/model/Person-validation.xml
 * src/main/resources/es/cemi/samples/webapp/action/PersonAction-validation.xml
 * src/main/webapp/WEB-INF/pages/personForm.jsp
 * src/main/webapp/WEB-INF/pages/personList.jsp
 * src/test/java/es/cemi/samples/webapp/action/PersonActionTest.java

Y modifica los siguientes:
 * src/main/resources/ApplicationResources.properties
 * src/main/resources/hibernate.cfg.xml
   * Mapeamos la nueva entidad en Hibernate:
   {{{
   <mapping class="es.cemi.samples.model.Person"/>
   }}}
 * src/main/resources/struts.xml
   * Declaramos en Struts2 las instancias que vamos a utilizar en las JSPs para esta entidad Person
   {{{
   <action name="persons" class="es.cemi.samples.webapp.action.PersonAction" method="list">
     <result>/WEB-INF/pages/personList.jsp</result>
   </action>
   
   <action name="editPerson" class="es.cemi.samples.webapp.action.PersonAction" method="edit">
     <result>/WEB-INF/pages/personForm.jsp</result>
     <result name="error">/WEB-INF/pages/personList.jsp</result>
   </action>
   
   <action name="savePerson" class="es.cemi.samples.webapp.action.PersonAction" method="save">
     <result name="input">/WEB-INF/pages/personForm.jsp</result>
     <result name="cancel" type="redirect-action">persons</result>
     <result name="delete" type="redirect-action">persons</result>
     <result name="success" type="redirect-action">persons</result>
   </action>
   }}}
 * src/main/webapp/common/menu.jsp
 * src/main/webapp/WEB-INF/applicationContext.xml
   * Creamos una instancia nueva de DAO genérico y Manager genérico para esta nueva entidad en el contexto de Spring
   {{{
   <bean id="personManager" class="org.appfuse.service.impl.GenericManagerImpl">
     <constructor-arg>
       <bean class="org.appfuse.dao.hibernate.GenericDaoHibernate">
         <constructor-arg value="es.cemi.samples.model.Person"/>
         <property name="sessionFactory" ref="sessionFactory"/>
        </bean>
      </constructor-arg>
    </bean>
    }}}
 * src/main/webapp/WEB-INF/menu-config.xml
 * src/test/resources/sample-data.xml
 * src/test/resources/web-tests.xml
 